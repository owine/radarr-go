{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:base",
    "docker:enableMajor",
    ":dependencyDashboard",
    ":semanticCommits",
    ":separateMultipleMajorReleases",
    ":combinePatchMinorReleases",
    "group:monorepos",
    "group:recommended",
    "workarounds:all"
  ],
  "timezone": "UTC",
  "schedule": ["before 6am on monday"],
  "labels": ["dependencies"],
  "commitMessagePrefix": "deps:",
  "commitMessageAction": "update",
  "commitMessageTopic": "{{depName}}",
  "commitMessageExtra": "to {{newVersion}}",
  "prHourlyLimit": 2,
  "prConcurrentLimit": 10,
  "branchConcurrentLimit": 20,
  "semanticCommits": "enabled",
  "platformAutomerge": true,
  "assigneesFromCodeOwners": true,
  "reviewersFromCodeOwners": true,
  "vulnerabilityAlerts": {
    "labels": ["security"],
    "assignees": ["@radarr/security-team"]
  },
  "lockFileMaintenance": {
    "enabled": true,
    "schedule": ["before 6am on monday"],
    "commitMessageAction": "lock file maintenance"
  },
  "packageRules": [
    {
      "description": "Security updates - highest priority, no grouping",
      "matchPackagePatterns": ["*"],
      "isVulnerabilityAlert": true,
      "addLabels": ["security"],
      "automerge": true,
      "automergeType": "pr",
      "schedule": ["at any time"],
      "prPriority": 10,
      "groupName": null
    },
    {
      "description": "Critical Go dependencies - exclude from grouping, manual review",
      "matchManagers": ["gomod"],
      "matchPackageNames": [
        "github.com/gin-gonic/gin",
        "gorm.io/gorm",
        "github.com/golang-migrate/migrate/v4"
      ],
      "groupName": null,
      "automerge": false,
      "addLabels": ["critical-dependency"],
      "reviewers": ["@radarr/maintainers"]
    },
    {
      "description": "Database drivers - exclude from grouping, manual review", 
      "matchManagers": ["gomod"],
      "matchPackagePatterns": [
        "github.com/lib/pq",
        "github.com/mattn/go-sqlite3",
        "gorm.io/driver/*",
        "github.com/jackc/pgx/*"
      ],
      "groupName": null,
      "addLabels": ["database"],
      "automerge": false,
      "reviewers": ["@radarr/maintainers"]
    },
    {
      "description": "Go version updates - exclude from grouping, manual review",
      "matchManagers": ["gomod"],
      "matchDepTypes": ["golang"],
      "groupName": null,
      "rangeStrategy": "replace",
      "automerge": false,
      "addLabels": ["golang-version", "major-update"],
      "reviewers": ["@radarr/maintainers"]
    },
    {
      "description": "Go major updates - separate from grouped updates",
      "matchManagers": ["gomod"],
      "matchUpdateTypes": ["major"],
      "groupName": "Go major updates",
      "groupSlug": "go-major",
      "automerge": false,
      "addLabels": ["major-update", "go"],
      "reviewers": ["@radarr/maintainers"],
      "commitMessageTopic": "Go major dependencies"
    },
    {
      "description": "Group non-critical Go module updates together",
      "matchManagers": ["gomod"],
      "matchUpdateTypes": ["minor", "patch"],
      "groupName": "Go dependencies",
      "groupSlug": "go-dependencies",
      "semanticCommitType": "deps",
      "automerge": true,
      "automergeType": "pr",
      "requiredStatusChecks": null,
      "minimumReleaseAge": "3 days",
      "internalChecksFilter": "strict",
      "addLabels": ["go"],
      "commitMessageTopic": "Go dependencies"
    },
    {
      "description": "Group Docker image updates together",
      "matchManagers": ["dockerfile", "docker-compose"],
      "matchUpdateTypes": ["minor", "patch"],
      "groupName": "Docker images",
      "groupSlug": "docker-images",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": ["docker"],
      "minimumReleaseAge": "3 days",
      "commitMessageTopic": "Docker images"
    },
    {
      "description": "Docker major updates - separate from grouped updates",
      "matchManagers": ["dockerfile", "docker-compose"],
      "matchUpdateTypes": ["major"],
      "groupName": "Docker major updates",
      "groupSlug": "docker-major",
      "automerge": false,
      "addLabels": ["major-update", "docker"],
      "commitMessageTopic": "Docker major images"
    },
    {
      "description": "Group GitHub Actions updates together",
      "matchManagers": ["github-actions"],
      "groupName": "GitHub Actions",
      "groupSlug": "github-actions",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": ["github-actions"],
      "minimumReleaseAge": "3 days",
      "rangeStrategy": "pin",
      "commitMessageTopic": "GitHub Actions"
    },
    {
      "description": "Group test and development dependencies together",
      "matchManagers": ["gomod"],
      "matchPackageNames": [
        "github.com/stretchr/testify"
      ],
      "matchPackagePatterns": [
        "github.com/stretchr/testify/*"
      ],
      "groupName": "Test dependencies",
      "groupSlug": "test-deps",
      "addLabels": ["testing"],
      "automerge": true,
      "commitMessageTopic": "test dependencies"
    },
    {
      "description": "Group logging and observability dependencies",
      "matchManagers": ["gomod"],
      "matchPackageNames": [
        "go.uber.org/zap",
        "go.uber.org/multierr"
      ],
      "matchPackagePatterns": [
        "go.uber.org/zap/*"
      ],
      "groupName": "Observability dependencies",
      "groupSlug": "observability-deps", 
      "addLabels": ["observability"],
      "automerge": true,
      "commitMessageTopic": "observability dependencies"
    },
    {
      "description": "Group utility and helper dependencies",
      "matchManagers": ["gomod"],
      "matchPackageNames": [
        "github.com/spf13/viper",
        "github.com/google/uuid"
      ],
      "matchPackagePatterns": [
        "github.com/spf13/*",
        "golang.org/x/tools/cmd/*"
      ],
      "groupName": "Utility dependencies", 
      "groupSlug": "utility-deps",
      "addLabels": ["utilities"],
      "automerge": true,
      "commitMessageTopic": "utility dependencies"
    }
  ],
  "regexManagers": [
    {
      "description": "Update Go version in Dockerfile",
      "fileMatch": ["^Dockerfile$"],
      "matchStrings": [
        "FROM golang:(?<currentValue>.*?)-alpine"
      ],
      "depNameTemplate": "golang",
      "datasourceTemplate": "docker"
    },
    {
      "description": "Update Go version in GitHub Actions",
      "fileMatch": ["^\\.github/workflows/.*\\.ya?ml$"],
      "matchStrings": [
        "go-version: ['\"]?(?<currentValue>.*?)['\"]?"
      ],
      "depNameTemplate": "golang",
      "datasourceTemplate": "golang-version"
    }
  ],
  "customManagers": [
    {
      "customType": "regex",
      "description": "Update alpine version in Dockerfile",
      "fileMatch": ["^Dockerfile$"],
      "matchStrings": [
        "FROM alpine:(?<currentValue>.*?)\\s"
      ],
      "depNameTemplate": "alpine",
      "datasourceTemplate": "docker"
    }
  ]
}